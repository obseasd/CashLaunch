{
  "contractName": "BondingCurve",
  "constructorInputs": [
    {
      "name": "creatorPkh",
      "type": "bytes20"
    },
    {
      "name": "basePrice",
      "type": "int"
    },
    {
      "name": "slope",
      "type": "int"
    },
    {
      "name": "totalSupply",
      "type": "int"
    }
  ],
  "abi": [
    {
      "name": "buy",
      "inputs": []
    },
    {
      "name": "sell",
      "inputs": []
    },
    {
      "name": "withdraw",
      "inputs": [
        {
          "name": "pk",
          "type": "pubkey"
        },
        {
          "name": "s",
          "type": "sig"
        }
      ]
    }
  ],
  "bytecode": "OP_4 OP_PICK OP_0 OP_NUMEQUAL OP_IF OP_INPUTINDEX OP_OUTPUTBYTECODE OP_INPUTINDEX OP_UTXOBYTECODE OP_EQUALVERIFY OP_INPUTINDEX OP_OUTPUTTOKENCATEGORY OP_INPUTINDEX OP_UTXOTOKENCATEGORY OP_EQUALVERIFY OP_INPUTINDEX OP_UTXOTOKENAMOUNT OP_INPUTINDEX OP_OUTPUTTOKENAMOUNT OP_SUB OP_DUP OP_0 OP_GREATERTHAN OP_VERIFY OP_INPUTINDEX OP_OUTPUTVALUE OP_INPUTINDEX OP_UTXOVALUE OP_SUB OP_5 OP_ROLL OP_INPUTINDEX OP_UTXOTOKENAMOUNT OP_SUB OP_2 OP_PICK OP_5 OP_ROLL OP_MUL OP_5 OP_ROLL OP_4 OP_PICK OP_MUL OP_2 OP_3 OP_ROLL OP_MUL OP_4 OP_ROLL OP_ADD OP_MUL OP_2 OP_DIV OP_ADD OP_GREATERTHANOREQUAL OP_NIP OP_NIP OP_ELSE OP_4 OP_PICK OP_1 OP_NUMEQUAL OP_IF OP_INPUTINDEX OP_OUTPUTBYTECODE OP_INPUTINDEX OP_UTXOBYTECODE OP_EQUALVERIFY OP_INPUTINDEX OP_OUTPUTTOKENCATEGORY OP_INPUTINDEX OP_UTXOTOKENCATEGORY OP_EQUALVERIFY OP_INPUTINDEX OP_OUTPUTTOKENAMOUNT OP_INPUTINDEX OP_UTXOTOKENAMOUNT OP_SUB OP_DUP OP_0 OP_GREATERTHAN OP_VERIFY OP_INPUTINDEX OP_UTXOVALUE OP_INPUTINDEX OP_OUTPUTVALUE OP_SUB OP_5 OP_ROLL OP_INPUTINDEX OP_UTXOTOKENAMOUNT OP_SUB OP_2 OP_PICK OP_5 OP_ROLL OP_MUL OP_5 OP_ROLL OP_4 OP_PICK OP_MUL OP_2 OP_3 OP_ROLL OP_MUL OP_4 OP_ROLL OP_SUB OP_MUL OP_2 OP_DIV OP_ADD OP_LESSTHANOREQUAL OP_NIP OP_NIP OP_ELSE OP_4 OP_ROLL OP_2 OP_NUMEQUALVERIFY OP_4 OP_PICK OP_HASH160 OP_EQUALVERIFY OP_4 OP_ROLL OP_4 OP_ROLL OP_CHECKSIG OP_NIP OP_NIP OP_NIP OP_ENDIF OP_ENDIF",
  "source": "pragma cashscript ^0.12.0;\n\n// CashLaunch Bonding Curve Covenant\n// Holds CashTokens + BCH. Enforces linear pricing: price(n) = basePrice + slope * n\n// where n is the number of tokens already sold.\n// All math is integer-only (sats and token units).\n\ncontract BondingCurve(bytes20 creatorPkh, int basePrice, int slope, int totalSupply) {\n\n    // Buy tokens from the contract.\n    // Buyer sends BCH, receives tokens. Contract preserves itself (covenant).\n    function buy() {\n        // COVENANT: output must preserve the contract's locking bytecode\n        require(tx.outputs[this.activeInputIndex].lockingBytecode ==\n                tx.inputs[this.activeInputIndex].lockingBytecode);\n\n        // Same token category must be preserved\n        require(tx.outputs[this.activeInputIndex].tokenCategory ==\n                tx.inputs[this.activeInputIndex].tokenCategory);\n\n        // Calculate how many tokens the buyer is taking\n        int tokensBought = tx.inputs[this.activeInputIndex].tokenAmount\n                         - tx.outputs[this.activeInputIndex].tokenAmount;\n        require(tokensBought > 0);\n\n        // Calculate BCH added to the contract\n        int bchAdded = tx.outputs[this.activeInputIndex].value\n                     - tx.inputs[this.activeInputIndex].value;\n\n        // Number of tokens already sold (outside the contract)\n        int sold = totalSupply - tx.inputs[this.activeInputIndex].tokenAmount;\n\n        // Linear bonding curve cost:\n        // Integrate price(x) = basePrice + slope * x from sold to (sold + tokensBought)\n        // cost = tokensBought * basePrice + slope * tokensBought * (2 * sold + tokensBought) / 2\n        int cost = tokensBought * basePrice\n                 + slope * tokensBought * (2 * sold + tokensBought) / 2;\n\n        require(bchAdded >= cost);\n    }\n\n    // Sell tokens back to the contract.\n    // Seller returns tokens, receives BCH. Contract preserves itself (covenant).\n    function sell() {\n        // COVENANT: output must preserve the contract's locking bytecode\n        require(tx.outputs[this.activeInputIndex].lockingBytecode ==\n                tx.inputs[this.activeInputIndex].lockingBytecode);\n\n        // Same token category must be preserved\n        require(tx.outputs[this.activeInputIndex].tokenCategory ==\n                tx.inputs[this.activeInputIndex].tokenCategory);\n\n        // Calculate how many tokens are being returned to the contract\n        int tokensReturned = tx.outputs[this.activeInputIndex].tokenAmount\n                           - tx.inputs[this.activeInputIndex].tokenAmount;\n        require(tokensReturned > 0);\n\n        // Calculate BCH removed from the contract\n        int bchRemoved = tx.inputs[this.activeInputIndex].value\n                       - tx.outputs[this.activeInputIndex].value;\n\n        // Number of tokens already sold (outside the contract) BEFORE this sell\n        int sold = totalSupply - tx.inputs[this.activeInputIndex].tokenAmount;\n\n        // Refund: integrate price(x) from (sold - tokensReturned) to sold\n        // refund = tokensReturned * basePrice + slope * tokensReturned * (2 * sold - tokensReturned) / 2\n        int refund = tokensReturned * basePrice\n                   + slope * tokensReturned * (2 * sold - tokensReturned) / 2;\n\n        require(bchRemoved <= refund);\n    }\n\n    // Creator can withdraw all funds + remaining tokens\n    function withdraw(pubkey pk, sig s) {\n        require(hash160(pk) == creatorPkh);\n        require(checkSig(s, pk));\n    }\n}\n",
  "debug": {
    "bytecode": "5479009c63c0cdc0c788c0d1c0ce88c0d0c0d3947600a069c0ccc0c694557ac0d0945279557a95557a54799552537a95547a9395529693a27777675479519c63c0cdc0c788c0d1c0ce88c0d3c0d0947600a069c0c6c0cc94557ac0d0945279557a95557a54799552537a95547a9495529693a1777767547a529d5479a988547a547aac7777776868",
    "sourceMap": "12:4:40:5;;;;;14:27:14:48;:16::65:1;15:26:15:47:0;:16::64:1;14:8::66;18:27:18:48:0;:16::63:1;19:26:19:47:0;:16::62:1;18:8::64;22:37:22:58:0;:27::71:1;23:38:23:59:0;:27::72:1;22;24:16:24:28:0;:31::32;:16:::1;:8::34;27:34:27:55:0;:23::62:1;28:33:28:54:0;:23::61:1;27;31:19:31:30:0;;:43::64;:33::77:1;:19;36::36:31:0;;:34::43;;:19:::1;37::37:24:0;;:27::39;;:19:::1;:43::44:0;:47::51;;:43:::1;:54::66:0;;:43:::1;:19::67;:70::71:0;:19:::1;36;39:8:39:34;12:4:40:5;;;44::71::0;;;;;46:27:46:48;:16::65:1;47:26:47:47:0;:16::64:1;46:8::66;50:27:50:48:0;:16::63:1;51:26:51:47:0;:16::62:1;50:8::64;54:40:54:61:0;:29::74:1;55:39:55:60:0;:29::73:1;54;56:16:56:30:0;:33::34;:16:::1;:8::36;59:35:59:56:0;:25::63:1;60:36:60:57:0;:25::64:1;59;63:19:63:30:0;;:43::64;:33::77:1;:19;67:21:67:35:0;;:38::47;;:21:::1;68::68:26:0;;:29::43;;:21:::1;:47::48:0;:51::55;;:47:::1;:58::72:0;;:47:::1;:21::73;:76::77:0;:21:::1;67;70:8:70:38;44:4:71:5;;;74::77::0;;;;75:24:75:26;;:16::27:1;:8::43;76:25:76:26:0;;:28::30;;:8::33:1;74:4:77:5;;;8:0:78:1;",
    "logs": [],
    "requires": [
      {
        "ip": 13,
        "line": 14
      },
      {
        "ip": 18,
        "line": 18
      },
      {
        "ip": 27,
        "line": 24
      },
      {
        "ip": 60,
        "line": 39
      },
      {
        "ip": 72,
        "line": 46
      },
      {
        "ip": 77,
        "line": 50
      },
      {
        "ip": 86,
        "line": 56
      },
      {
        "ip": 119,
        "line": 70
      },
      {
        "ip": 129,
        "line": 75
      },
      {
        "ip": 135,
        "line": 76
      }
    ]
  },
  "compiler": {
    "name": "cashc",
    "version": "0.12.1"
  },
  "updatedAt": "2026-02-25T13:07:35.813Z"
}